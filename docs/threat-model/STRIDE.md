| Поток/Элемент | Угроза (STRIDE) | Rиск | Контроль | Ссылка на NFR | Проверка/Артефакт |
|---|---|---|---|---|---|
| F1 Client→Edge (HTTPS) | S/T/I: MITM, перехват API-ключей при отсутствии TLS | R3 | Принудительный HTTPS, TLS 1.2+, HSTS (redirect с HTTP на HTTPS) | NFR-04 | SSL Labs ≥ A-, конфиг Ingress/Proxy |
| F2 Edge→App (internal) | T/I: прослушка/подмена на внутреннем сегменте | R9 | mTLS/частная сеть/NetworkPolicy, TLS сквозной где возможно | NFR-04 | Конфиг кластера/compose, проверка шифрования |
| F3 Хэширование пароля | I: слабое хэширование → компрометация паролей | R4 | Argon2id с параметрами из NFR, запрет логирования паролей | NFR-01, NFR-05 | Unit-тест на префикс $argon2id…, code review |
| F4 Запись пользователя в БД | R: отсутствие аудита создания учётки | R12 | Аудит-события (успех/ошибка), структурированные JSON-логи | NFR-05 | Просмотр логов на stage, линтер PII |
| F5 Проверка X-API-Key | S: подбор/кража API-ключа | R2 | Rate limit per-IP/per-key, TLS, лог аутентификации (без ключей) | NFR-02, NFR-04, NFR-05 | e2e негативные тесты, анализ логов |
| F5/F5a SELECT user by api_key | I: утечка API-ключа в логах/трейсах | R7 | Маскирование/запрет логирования секретов (заголовков) | NFR-05 | Греп логов, линтеры секретов |
| F6 CRUD wishes | E: IDOR — доступ к чужим данным | R5 | Проверка owner_id на всех путях, негативные тесты | NFR-06 | BDD-сценарий NFR-06, e2e |
| F6 CRUD wishes | T: модификация чужих записей | R5 | Те же проверки ACL + контрактные тесты | NFR-06 | Тесты на 403 |
| F1/F2 Любые эндпоинты | D: DoS чрезмерными запросами | R11 | Rate limiting на Edge+App, базовые квоты | NFR-02 | Интеграционные тесты на 429 |
| F1/F6 Нагрузка на API | D: деградация производительности | R10 | Профилирование/оптимизация, целевой p99 | NFR-08 | k6: p99 ≤ 400мс при 50 RPS |
| ERR Обработчик ошибок | I: раскрытие внутренних деталей/stack trace | R6 | Стандартизированный JSON-ответ, без деталей | NFR-07 | tests/test_errors.py зелёный, e2e |
| Build/Deps (CI SCA) | T: уязвимые/вредоносные зависимости | R8 | SCA (pip-audit/Trivy/Snyk) в CI | NFR-03 | Зеленый шаг SCA, 0 High/Critical |
