# ADR-002: Хэширование паролей Argon2id с параметрами
Дата: 2025-10-2w
Статус: Accepted

## Context
- Пароли — критический актив; слабые параметры повышают риск компрометации (R4).
- Ранее были включены схемы `argon2` и `bcrypt` без жёстко зафиксированных параметров.
- По NFR-01 необходимо использовать Argon2id с заданными параметрами.

## Decision
- Используем только Argon2id через `passlib`.
- Фиксируем параметры:
  - `argon2__type=ID`
  - `argon2__time_cost=3`
  - `argon2__memory_cost=65536`
  - `argon2__parallelism=4`
- Не логируем пароли и хэши (связь с NFR-05).

## Consequences
- Плюсы: современная криптостойкость к оффлайн-перебору (GPU/ASIC), соответствие NFR-01.
- Минусы: рост затрат CPU/памяти при регистрации/смене пароля — приемлемо для сервиса.

## Alternatives
- bcrypt/scrypt/PBKDF2 — допустимы, но не соответствуют выбранному стандарту в NFR-01 (предпочтение — Argon2id).

## Links
- NFR: NFR-01 (Стойкое хэширование паролей), NFR-05 (Безопасное логирование)
- Threat Model: R4
- Реализация: `app/security.py` (настройка `CryptContext` только на Argon2id с параметрами)
- Tests:
  - `tests/test_security.py::test_password_hash_prefix_argon2id`
