# Нефункциональные требования (NFR) для проекта Wishlist

| ID          | Название                               | Описание                                                                                                                  | Метрика/Порог                                                                     | Проверка (чем/где)                                        | Компонент            | Приоритет |
|-------------|----------------------------------------|---------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|-----------------------------------------------------------|----------------------|-----------|
| **NFR-01** | Стойкое хэширование паролей            | Пароли пользователей должны хэшироваться с использованием современного и стойкого к перебору алгоритма. `bcrypt` считается устаревающим. | Использовать **Argon2id** со следующими параметрами: `time_cost=3`, `memory_cost=65536`, `parallelism=4`. | Code Review (`app/security.py`), Unit-тест.               | `auth` (`security.py`) | Critical  |
| **NFR-02** | Ограничение частоты запросов (Rate Limiting) | Защита от brute-force атак на эндпоинты регистрации и аутентификации.                                                    | - `/api/users/` (регистрация): **≤ 5 запросов/мин** с одного IP.<br>- Все эндпоинты с `X-API-Key`: **≤ 100 запросов/мин** с одного IP. | Интеграционные тесты, проверка конфигурации Middleware/Gateway. | `api-gateway` / `middleware` | High      |
| **NFR-03** | Сканирование зависимостей на уязвимости (SCA) | Проект не должен использовать библиотеки с известными уязвимостями высокого или критического уровня.              | Отсутствие уязвимостей уровня **High/Critical**. Срок исправления: High - 7 дней, Critical - 3 дня. | CI-пайплайн (c помощью `pip-audit`, `Trivy`, `Snyk`).         | `build`              | High      |
| **NFR-04** | Защита трафика (TLS)                   | Весь трафик между клиентом и сервером должен быть зашифрован для предотвращения перехвата данных, включая API-ключи. | **TLS 1.2+** для всего трафика. Обязательное использование **HTTPS**. Заголовок HSTS включен. | Конфигурация веб-сервера/Ingress, онлайн-сканеры (SSL Labs). | `platform` / `infra`   | Critical  |
| **NFR-05** | Безопасное логирование                 | Логи не должны содержать чувствительную информацию (PII), такую как пароли или API-ключи. Логи должны быть структурированы. | **100%** логов не содержат PII. Формат логов — **JSON**. Все аутентификационные события (успех/неудача) логгируются. | Code Review, SAST-сканеры, проверка логов на stage-окружении. | `app` (global)       | Medium    |
| **NFR-06** | Контроль доступа к данным (Least Privilege) | Пользователь должен иметь доступ только к своим собственным данным (вишлистам).                                       | **100%** эндпоинтов `wishes` проверяют, что `current_user.id` соответствует `wish.owner_id`. | Интеграционные/e2e тесты, симулирующие доступ к чужим данным. | `api` (`wishes.py`)    | High      |
| **NFR-07** | Безопасная обработка ошибок            | Ответы об ошибках не должны раскрывать внутреннюю структуру приложения, пути файлов или stack trace.                       | **100%** ответов с кодами `4xx/5xx` имеют стандартизированную структуру JSON без отладочной информации. | Code Review (`main.py`), e2e-тесты с вызовом ошибок.      | `app` (`main.py`)      | Medium    |
| **NFR-08** | Производительность API аутентификации  | Регистрация и проверка API-ключа не должны быть узким местом системы.                                                    | p99 времени ответа для **POST /api/users/** и для любого запроса с `X-API-Key` **≤ 400 мс** при нагрузке 50 RPS. | Нагрузочное тестирование (k6, Gatling) на stage-окружении. | `auth`, `api`        | High      |
