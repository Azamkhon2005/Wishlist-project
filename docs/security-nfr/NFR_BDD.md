# Сценарии приемки для Нефункциональных требований (BDD)

## Feature: Хранение паролей пользователей (NFR-01)

**Scenario:** Пароль нового пользователя хэшируется с помощью усиленного Argon2id

**Given** система сконфигурирована для использования Argon2id с параметрами: `time_cost=3`, `memory_cost=65536`, `parallelism=4`

**When** новый пользователь отправляет запрос `POST /api/users/` с валидным именем и паролем

**Then** в базе данных его пароль сохранен в виде хэша, который начинается со строки `"$argon2id$v=19$m=65536,t=3,p=4"`

## Feature: Контроль доступа к данным (NFR-06)

**Scenario (Negative):** Пользователь не может получить доступ к чужому желанию

**Given** существуют два пользователя: `Alice` с `ID=1` и `Bob` с `ID=2`

**And** у пользователя `Bob` существует желание `"Купить книгу"` с `ID=101`

**When** пользователь `Alice` отправляет `GET` запрос на `/api/wishes/101`, используя свой API-ключ

**Then** система возвращает ответ с кодом состояния `403 Forbidden`

**And** тело ответа содержит сообщение об ошибке `"Not enough permissions"`

## Feature: Защита от перебора на эндпоинте регистрации (NFR-02)

**Scenario (Negative):** Клиент получает ошибку после превышения лимита запросов на регистрацию

**Given** система настроена с ограничением в 5 запросов в минуту для `POST /api/users/` с одного IP

**And** клиент с IP-адреса `10.0.0.1` уже отправил 5 запросов на этот эндпоинт в течение последней минуты

**When** тот же клиент отправляет 6-й запрос на `POST /api/users/`

**Then** система возвращает ответ с кодом состояния `429 Too Many Requests`

## Feature: Производительность API (NFR-08)

**Scenario:** p99 времени ответа API остается в пределах нормы под нагрузкой

**Given** сервис развернут на `staging`-окружении

**When** запускается 5-минутный нагрузочный тест с интенсивностью 50 RPS, эмулирующий запросы к `/api/wishes/` (с валидным API-ключом)

**Then** 99-й перцентиль (p99) времени ответа для этого эндпоинта не превышает **400 ms**
